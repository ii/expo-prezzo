<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Select a presentation</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <script src="/app.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <body>
    <h1>What interests you?</h1>
    <p><p>
    <div id='presentation-selector'></div>
  </body>
  <script>
   const params = new URLSearchParams(window.location.search)
   const URL = window.location.origin
   const socket = io(URL, {autoConnect: true});
   const title = document.querySelector("h1");

   const monitorName = params.get("m")

   function requestPresentation (presentation, sessionID) {
     socket.emit("presentation request", {presentation, sessionID});
   }
   document.addEventListener("DOMContentLoaded", () => {
     if (typeof monitorName === "undefined" || !monitorName) {
       console.log("No monitorName declared")
       document.querySelector("h1").textContent = "Please scan a QR code on a monitor.";
       document.querySelector("p").textContent = "Camera apps on most smartphones already support this.";
     } else {
       console.log('monitor match');
       socket.emit("get token", monitorName)
       socket.emit("get presentations")
       socket.on("presentation list", ({presentationsNames}) => {
           presentationsNames.forEach(name => {
             var presentationButton = document.createElement('a')
             presentationButton.innerHTML = name
             presentationButton.href = `${window.location.origin}/presentations/${name}/presentation.html`
             presentationButton.onclick = () => requestPresentation(name, monitorSessionID);
             document.querySelector("#presentation-selector").appendChild(presentationButton)
           })
           document.querySelector("p").textContent = "Select a presentation to display";
         // TODO set styling for presentations
         // background-color: #d4d4d4;
         // color: black;
         // padding: 20px 20px;
         // margin: 10px;
         // display: block;
       })

       socket.on("new token", (monitor) => {
         console.log('new token', {monitor});
         if (monitorName != monitor.monitorName) {
           return
         } else {
          sessionStorage.setItem("monitor", JSON.stringify({monitorName, token: monitor.token, secret: monitor.secret}));
         }
       })
     }
   })
  </script>
</html>
